<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Airfoil Design Tool</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>Interactive Airfoil Design Tool</h1>
            <p class="subtitle">Design custom airfoils using neural networks</p>
            <nav style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
                <a href="/hof" class="btn btn-secondary" style="text-decoration: none;">Hall of Fame</a>
                <button class="btn btn-secondary" onclick="toggleSettings()" id="settings-btn">Settings</button>
            </nav>
        </header>

        <!-- Settings Modal -->
        <div id="settings-modal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 600px;">
                <span class="modal-close" onclick="closeSettings()">&times;</span>
                <h2>Settings</h2>
                <div class="settings-section">
                    <h3>Custom Colors</h3>
                    <div class="color-input-group">
                        <label>Primary Color:</label>
                        <input type="color" id="color-primary" value="#2563eb" onchange="updateColors()">
                    </div>
                    <div class="color-input-group">
                        <label>Success Color:</label>
                        <input type="color" id="color-success" value="#10b981" onchange="updateColors()">
                    </div>
                    <div class="color-input-group">
                        <label>Secondary Color:</label>
                        <input type="color" id="color-secondary" value="#6b7280" onchange="updateColors()">
                    </div>
                    <div class="color-input-group">
                        <label>Background:</label>
                        <input type="color" id="color-background" value="#f9fafb" onchange="updateColors()">
                    </div>
                    <div class="color-input-group">
                        <label>Card Background:</label>
                        <input type="color" id="color-card" value="#ffffff" onchange="updateColors()">
                    </div>
                    <button class="btn btn-secondary" onclick="resetColors()" style="margin-top: 10px;">Reset to Default</button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Step 1: Flight Conditions -->
            <section class="card" id="step1">
                <h2>1. Flight Conditions</h2>
                <div class="form-group">
                    <label for="chord">Chord Length (ft)</label>
                    <input type="number" id="chord" step="0.01" value="5.0" placeholder="e.g., 5.0">
                </div>
                <div class="form-group">
                    <label for="speed">Speed (mph)</label>
                    <input type="number" id="speed" step="0.01" value="100.0" placeholder="e.g., 100.0">
                </div>
                <button class="btn btn-primary" onclick="computeReynolds()">Compute Reynolds & Mach</button>
                <div id="reynolds-result" class="result-box" style="display: none;">
                    <p><strong>Reynolds Number:</strong> <span id="re-value"></span></p>
                    <p><strong>Mach Number:</strong> <span id="mach-value"></span></p>
                </div>
            </section>

            <!-- Step 2: Angle Range -->
            <section class="card" id="step2">
                <h2>2. Angle of Attack Range</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="alpha-min">Minimum Angle (deg)</label>
                        <input type="number" id="alpha-min" step="0.1" value="-5.0">
                    </div>
                    <div class="form-group">
                        <label for="alpha-max">Maximum Angle (deg)</label>
                        <input type="number" id="alpha-max" step="0.1" value="15.0">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="generateAlpha()">Generate Alpha Vector</button>
                <div id="alpha-result" class="result-box" style="display: none;">
                    <p><strong>Generated:</strong> <span id="alpha-count"></span> angles</p>
                </div>
            </section>

            <!-- Step 3: Cl Input -->
            <section class="card" id="step3">
                <h2>3. Lift Coefficient (Cl) Curve</h2>
                <p class="help-text">Enter control points as "alpha,value" (e.g., "5.0,1.2") or click on the chart to add points. The spline will interpolate between points.</p>
                <div class="point-input-section">
                    <div class="input-controls">
                        <input type="text" id="cl-point-input" placeholder="e.g., 5.0,1.2" class="point-input">
                        <button class="btn btn-sm" onclick="addClPoint()">Add Point</button>
                        <button class="btn btn-sm btn-secondary" onclick="clearClPoints()">Clear All</button>
                    </div>
                    <div id="cl-points-list" class="points-list"></div>
                </div>
                <div id="cl-chart" class="chart-container"></div>
                <button class="btn btn-primary" onclick="interpolateCl()">Update Interpolation</button>
            </section>

            <!-- Step 4: Cl/Cd Input -->
            <section class="card" id="step4">
                <h2>4. Lift-to-Drag Ratio (Cl/Cd) Curve</h2>
                <p class="help-text">Enter control points as "alpha,value" (e.g., "5.0,100.0") or click on the chart to add points. The spline will interpolate between points.</p>
                <div class="point-input-section">
                    <div class="input-controls">
                        <input type="text" id="clcd-point-input" placeholder="e.g., 5.0,100.0" class="point-input">
                        <button class="btn btn-sm" onclick="addClCdPoint()">Add Point</button>
                        <button class="btn btn-sm btn-secondary" onclick="clearClCdPoints()">Clear All</button>
                    </div>
                    <div id="clcd-points-list" class="points-list"></div>
                </div>
                <div id="clcd-chart" class="chart-container"></div>
                <button class="btn btn-primary" onclick="interpolateClCd()">Update Interpolation</button>
            </section>

            <!-- Step 5: Thickness Range -->
            <section class="card" id="step5">
                <h2>5. Thickness Search Range</h2>
                <p class="help-text">The optimization will automatically test different thickness combinations to find the best airfoil. Specify the range of maximum thickness values to search (in 0.01 increments). For each maximum thickness tested, the system will also try all minimum thickness values from 0.01 up to half of that maximum thickness.</p>
                <p class="help-text"><strong>Example:</strong> If you set 0.10 to 0.20, it will test max thicknesses of 0.10, 0.11, 0.12... up to 0.20. For max thickness 0.20, it will test min thicknesses of 0.01, 0.02, 0.03... up to 0.10 (half of 0.20).</p>
                <div class="form-row">
                    <div class="form-group">
                        <label for="max-thickness-min">Maximum Thickness - Minimum (chord fraction)</label>
                        <input type="number" id="max-thickness-min" step="0.01" value="0.10" placeholder="e.g., 0.10">
                        <small class="help-text">Lowest maximum thickness to test</small>
                    </div>
                    <div class="form-group">
                        <label for="max-thickness-max">Maximum Thickness - Maximum (chord fraction)</label>
                        <input type="number" id="max-thickness-max" step="0.01" value="0.20" placeholder="e.g., 0.20">
                        <small class="help-text">Highest maximum thickness to test</small>
                    </div>
                </div>
            </section>

            <!-- Step 6: Generate -->
            <section class="card" id="step6">
                <h2>6. Generate Airfoil</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="btn btn-success btn-large" onclick="generateAirfoil()" id="generate-btn" style="flex: 1;">
                        Generate Airfoil
                    </button>
                    <button class="btn btn-secondary" onclick="exportConfig()" id="export-btn">
                        Export Config
                    </button>
                    <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()" id="import-btn">
                        Import Config
                    </button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importConfig(event)">
                </div>
                <div id="optimization-status" style="display: none;">
                    <div class="progress-container">
                        <div class="progress-header">
                            <h3>Optimizing Airfoil</h3>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span id="progress-text">0%</span>
                                <button class="btn btn-sm" onclick="cancelOptimization()" id="cancel-btn">Cancel</button>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-details">
                            <p id="progress-details-text">Initializing...</p>
                        </div>
                    </div>
                    <div class="best-airfoil-preview">
                        <h3>Current Best Airfoil</h3>
                        <img id="best-airfoil-preview-img" src="" alt="Best Airfoil Preview" style="display: none;">
                        <div id="best-airfoil-stats" style="display: none;">
                            <p><strong>Max Thickness:</strong> <span id="best-max-thickness"></span></p>
                            <p><strong>Min Thickness:</strong> <span id="best-min-thickness"></span></p>
                            <p><strong>Error:</strong> <span id="best-error"></span></p>
                        </div>
                    </div>
                </div>
                <div id="loading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Finalizing results...</p>
                </div>
                <div id="error" class="error-box" style="display: none;"></div>
            </section>

            <!-- Results Section -->
            <section class="card results-section" id="results" style="display: none;">
                <h2>Results</h2>
                <div id="results-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Cl Max</div>
                            <div class="stat-value" id="stat-clmax"></div>
                            <div class="stat-detail" id="stat-clmax-alpha"></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Cd Min</div>
                            <div class="stat-value" id="stat-cdmin"></div>
                            <div class="stat-detail" id="stat-cdmin-alpha"></div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">L/D Max</div>
                            <div class="stat-value" id="stat-ldmax"></div>
                            <div class="stat-detail" id="stat-ldmax-alpha"></div>
                        </div>
                    </div>
                    
                    <div class="plot-container">
                        <h3>Airfoil Shape</h3>
                        <img id="airfoil-plot" src="" alt="Airfoil Shape">
                    </div>
                    
                    <div class="plot-container">
                        <h3>Aerodynamic Curves</h3>
                        <img id="curves-plot" src="" alt="Aerodynamic Curves">
                    </div>
                    
                    <div class="download-section">
                        <button class="btn btn-primary" onclick="downloadDat()">Download .dat File</button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
